/**
 * portfolio-static - v0.0.0 - 2013-05-15
 * 
 *
 * Copyright (c) 2013 Ivan Nikulin
 * Licensed MIT <https://raw.github.com/vansanblch/portfolio-static/master/LICENSE>
 */
(function(n,e){"use strict";var t,o;e.module("portfolioNgApp",["ngResource"]).config(["$routeProvider","$locationProvider",function(n,e){return n.when("/",{templateUrl:"/views/index.html"}).when("/menu/:menuId/edit",{templateUrl:"/views/menu_edit.html",controller:"MenuEditCtrl"}).when("/menu/:menuId/cards",{templateUrl:"/views/menu_cards.html",controller:"CardListCtrl"}).otherwise({redirectTo:"/"}),e.html5Mode(!1).hashPrefix("!")}]),o=function(n,e){n.tree=e.getTree()},o.$inject=["$scope","Menu"],e.module("portfolioNgApp").controller("MenuCtrl",o),t=function(n,t,o){var r,i,u,c,a;c=parseInt(t.menuId,10),i=!1,u=void 0,n.isInEditMode=function(){return i},n.editMode=function(){i=!0,u=e.copy(n.menu)},n.viewMode=function(){e.copy(u,n.menu),i=!1,u=void 0},n.save=function(n){o.save(n)},n.menu=o.currentMenu,r=0,a=!1,n.cards=o.getCards(c),n.isLinkDisabled=function(n){var e;return e=!1,"previous"===n&&0===r&&(e=!0),"next"===n&&r===a&&(e=!0),e},o.onMenuLoaded(n,function(t){e.forEach(t,function(e){e.id===c&&(n.menu=e)})})},t.$inject=["$scope","$routeParams","Menu"],e.module("portfolioNgApp").controller("CardListCtrl",t),e.module("portfolioNgApp").directive("niPersonaAuth",["Persona","$compile",function(n,e){var t,o,r;return t='<a><img class="persona" ng-click="request()" src="images/plain_sign_in_black.png"></a>',r='<a>{{email}} <span ng-click="signout()" class="button">Sign out</span></a>',o={template:'<li class="persona"><a>Persona</a></li>',restrict:"M",replace:!0},o.link=function(o,i){return o.request=function(){return n.request()},o.signout=function(){return n.signout()},n.onStatus(o,function(n){var u;return n.email?(o.email=n.email,u=r):u=t,i.html(u),e(i.contents())(o)})},o}]),e.module("portfolioNgApp").directive("niCard",[function(){var n,e;return e='<div class="card">\n    <h4 class="title">{{card.name}}</h4>\n    <img src="http://placehold.it/600x480/&text={{card.name}}">\n    <p>{{card.about}}</p>\n</div>',n={restrict:"M",replace:!0,template:e,link:function(n){return n.$last?$("#cards-list").foundation("orbit",{bullets:!1,slide_number:!1}):undefined}}}]),e.module("portfolioNgApp").directive("niMenu",[function(){var n;return n={template:'<ul>\n    <li data-ng-repeat="item in tree">\n        <!-- directive: ni-menu-item item -->\n    </li>\n</ul>',replace:!0,restrict:"M",scope:{tree:"=niMenu"}}}]),e.module("portfolioNgApp").directive("niMenuItem",["$compile","Menu",function(n,e){var t,o,r;return r=function(n){e.currentMenu=n},t=function(e,t){var o;return e.select=r,e.item.children.length?(o=n("<!-- directive: ni-menu item.children -->")(e),t.append(o)):undefined},o={restrict:"M",replace:!0,template:'<span><a ng-href="#!/menu/{{item.id}}/cards" ng-click="select(item)">{{item.name}}</a></span>',link:t}}]),e.module("portfolioNgApp").factory("Persona",["$http","$rootScope",function(n,e){var t,o,r,i;return o="Email of logged in user",r=void 0,i=function(){return console.log("_status"),n.jsonp("http://localhost:8000/auth/email?callback=JSON_CALLBACK").success(function(t){return console.log("get email",t),e.$broadcast(o,t),navigator.id.watch({loggedInUser:t.email,onlogin:function(t){return console.log("onlogin"),n.jsonp("http://localhost:8000/auth/login",{params:{callback:"JSON_CALLBACK",assertion:t}}).success(function(n){return console.log("verifyAssertion.success",n),e.$broadcast(o,n)})},onlogout:function(){return console.log("onlogout"),n.jsonp("http://localhost:8000/auth/logout?callback=JSON_CALLBACK").success(function(n){return console.log("auth/logout",n),e.$broadcast(o,n)})}})})},t={},t.onStatus=function(n,e){return console.log("Persona.onStatus",arguments),n.$on(o,function(n,t){return console.log("Persona.onStatus.$on",arguments),r=t.email,e(t)}),i()},t.request=function(){return console.log("request"),navigator.id.request()},t.signout=function(){return console.log("signout"),navigator.id.logout()},t.email=function(){return r},t}]),e.module("portfolioNgApp").factory("User",["$http","$rootScope",function(n){var e,t,o;return t=null,o=!1,e={},e.getEmail=function(){return"vansanblch@gmail.com"},e.isAuthenticated=function(){return o},e.login=function(){return n.post},e}]),e.module("portfolioNgApp").factory("Menu",["$resource","$http","$rootScope",function(n,t,o){var r,i,u,c,a,l,s;return c=!0,s=[],a=[],i={currentMenu:!1},u="treeLoaded",r="cardsLoaded",l=function(n,t){return null==t&&(t=s),null===n.parent_id?t.push(n):e.forEach(t,function(e){return c?e.id===n.parent_id?(c=!1,e.children.push(n)):l(n,e.children):undefined})},i.getTree=function(){var t;return s.length?s:(t="http://localhost\\:5000/menu/:action",n(t).query({action:"list"},function(n){return a=n.result,e.forEach(n.result,function(n){return n.children=[],c=!0,l(n)}),o.$broadcast(u,a)}),s)},i.onMenuLoaded=function(n,e){return n.$on(u,function(n,t){return e(t)})},i.onCardsLoaded=function(n,e){return n.$on(r,function(n,t){return e(t)})},i.getCards=function(t,o){return e.isFunction(o)||(o=e.noop),n("http://localhost\\:8000/get_cards/:menuId",{callback:"JSON_CALLBACK"},{query:{method:"JSONP"}}).query({menuId:t},o)},i.save=function(n){var e;return e=n.id,t.jsonp("http://localhost\\:8000/menu/:id/save",{id:"test",params:n})},i}])})(window,window.angular);